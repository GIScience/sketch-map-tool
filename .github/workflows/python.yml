name: Python Tools and Tests

on: [ push ]

jobs:
  test:
    runs-on: ubuntu-22.04
    defaults:
      run:
        shell: bash
    steps:
      - uses: actions/checkout@v3

      - name: Build the Docker image
        run: docker build . --file Dockerfile --tag sketch-map-tool-ci:${{ github.run_id }}

      - name: tmp
        run: docker images -a

      - name: Run flake8
        run: docker run --rm sketch-map-tool-ci:${{ github.run_id }} poetry run flake8 sketch_map_tool

      - name: Run bandit
        run: docker run --rm sketch-map-tool-ci:${{ github.run_id }} poetry run bandit --recursive sketch_map_tool

      - name: Run black
        run: docker run --rm sketch-map-tool-ci:${{ github.run_id }} poetry run black --check --diff sketch_map_tool

      - name: Run isort
        run: docker run --rm sketch-map-tool-ci:${{ github.run_id }} poetry run isort --check --diff sketch_map_tool

      - name: Running tests
        run: docker run --rm sketch-map-tool-ci:${{ github.run_id }} poetry run pytest tests/unit
