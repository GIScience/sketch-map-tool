(function(o,l){typeof exports=="object"&&typeof module<"u"?l(exports,require("ol/control/Control"),require("ol/proj"),require("ol/sphere"),require("ol")):typeof define=="function"&&define.amd?define(["exports","ol/control/Control","ol/proj","ol/sphere","ol"],l):(o=typeof globalThis<"u"?globalThis:o||self,l(o["ol-print-layout-control"]={},o.ol.control.Control,o.ol.proj,o.ol.sphere,o.ol))})(this,function(o,l,f,B,I){"use strict";var V=Object.defineProperty;var U=(o,l,f)=>l in o?V(o,l,{enumerable:!0,configurable:!0,writable:!0,value:f}):o[l]=f;var M=(o,l,f)=>(U(o,typeof l!="symbol"?l+"":l,f),f);const S=(s=>s&&typeof s=="object"&&"default"in s?s:{default:s})(l),$="";class C{constructor(){this.disposed=!1}dispose(){this.disposed||(this.disposed=!0,this.disposeInternal())}disposeInternal(){}}const N=C;class D{constructor(t){this.propagationStopped,this.defaultPrevented,this.type=t,this.target=null}preventDefault(){this.defaultPrevented=!0}stopPropagation(){this.propagationStopped=!0}}const O=D;function y(){}function b(s){for(const t in s)delete s[t]}class z extends N{constructor(t){super(),this.eventTarget_=t,this.pendingRemovals_=null,this.dispatching_=null,this.listeners_=null}addEventListener(t,e){if(!t||!e)return;const n=this.listeners_||(this.listeners_={}),i=n[t]||(n[t]=[]);i.includes(e)||i.push(e)}dispatchEvent(t){const e=typeof t=="string",n=e?t:t.type,i=this.listeners_&&this.listeners_[n];if(!i)return;const r=e?new O(t):t;r.target||(r.target=this.eventTarget_||this);const h=this.dispatching_||(this.dispatching_={}),c=this.pendingRemovals_||(this.pendingRemovals_={});n in h||(h[n]=0,c[n]=0),++h[n];let p;for(let a=0,d=i.length;a<d;++a)if("handleEvent"in i[a]?p=i[a].handleEvent(r):p=i[a].call(this,r),p===!1||r.propagationStopped){p=!1;break}if(--h[n]===0){let a=c[n];for(delete c[n];a--;)this.removeEventListener(n,y);delete h[n]}return p}disposeInternal(){this.listeners_&&b(this.listeners_)}getListeners(t){return this.listeners_&&this.listeners_[t]||void 0}hasListener(t){return this.listeners_?t?t in this.listeners_:Object.keys(this.listeners_).length>0:!1}removeEventListener(t,e){const n=this.listeners_&&this.listeners_[t];if(n){const i=n.indexOf(e);i!==-1&&(this.pendingRemovals_&&t in this.pendingRemovals_?(n[i]=y,++this.pendingRemovals_[t]):(n.splice(i,1),n.length===0&&delete this.listeners_[t]))}}}const F=z,K={CHANGE:"change",ERROR:"error",BLUR:"blur",CLEAR:"clear",CONTEXTMENU:"contextmenu",CLICK:"click",DBLCLICK:"dblclick",DRAGENTER:"dragenter",DRAGOVER:"dragover",DROP:"drop",FOCUS:"focus",KEYDOWN:"keydown",KEYPRESS:"keypress",LOAD:"load",RESIZE:"resize",TOUCHMOVE:"touchmove",WHEEL:"wheel"};function R(s,t,e,n,i){if(n&&n!==s&&(e=e.bind(n)),i){const h=e;e=function(){s.removeEventListener(t,e),h.apply(this,arguments)}}const r={target:s,type:t,listener:e};return s.addEventListener(t,e),r}function x(s,t,e,n){return R(s,t,e,n,!0)}function P(s){s&&s.target&&(s.target.removeEventListener(s.type,s.listener),b(s))}class _ extends F{constructor(){super(),this.on=this.onInternal,this.once=this.onceInternal,this.un=this.unInternal,this.revision_=0}changed(){++this.revision_,this.dispatchEvent(K.CHANGE)}getRevision(){return this.revision_}onInternal(t,e){if(Array.isArray(t)){const n=t.length,i=new Array(n);for(let r=0;r<n;++r)i[r]=R(this,t[r],e);return i}else return R(this,t,e)}onceInternal(t,e){let n;if(Array.isArray(t)){const i=t.length;n=new Array(i);for(let r=0;r<i;++r)n[r]=x(this,t[r],e)}else n=x(this,t,e);return e.ol_key=n,n}unInternal(t,e){const n=e.ol_key;if(n)T(n);else if(Array.isArray(t))for(let i=0,r=t.length;i<r;++i)this.removeEventListener(t[i],e);else this.removeEventListener(t,e)}}_.prototype.on,_.prototype.once,_.prototype.un;function T(s){if(Array.isArray(s))for(let t=0,e=s.length;t<e;++t)P(s[t]);else P(s)}class w extends O{constructor(t,e,n){super(t),this.key=e,this.oldValue=n}}var m=(s=>(s.PORTRAIT="portrait",s.LANDSCAPE="landscape",s))(m||{});const E={A4:"A4",A3:"A3",A2:"A2",A1:"A1",A0:"A0",LETTER:"LETTER",TABLOID:"TABLOID",BROADSHEET:"BROADSHEET"},u=25.4,A={A4:{short:210,long:297},A3:{short:297,long:420},A2:{short:420,long:594},A1:{short:594,long:841},A0:{short:841,long:1189},LETTER:{short:8.5*u,long:11*u},TABLOID:{short:11*u,long:17*u},BROADSHEET:{short:17*u,long:22*u}},g={BBOX:"bbox",FORMAT:"format",ORIENTATION:"orientation",MARGIN:"margin"};class L extends S.default{constructor(e={}){const{format:n=E.A4,orientation:i="portrait",margin:r={top:2,bottom:2,left:2,right:2}}=e,{element:h,printArea:c}=p();super({element:h,render:a=>{this.onRender(a)}});M(this,"printArea");M(this,"evtKeyMarginChange");M(this,"_map");this.printArea=c,this.set(g.ORIENTATION,i),this.set(g.FORMAT,n),this.setMargin(new v(r)),this.set(g.BBOX,null);function p(){const a=document.createElement("div");a.className="paper-format";const d=document.createElement("div");return d.className="print-area",d.id="print-area",a.appendChild(d),{element:a,printArea:d}}}getOrientation(){return this.get(g.ORIENTATION)}setOrientation(e){if(e.toUpperCase()in m)this.set(g.ORIENTATION,e),this.setElementSize(),this.getMap()&&(this.getMap().renderSync(),this.handleBboxChange()),this.changed();else throw new Error(`orientation must be one of: ${Object.values(m)}`)}getFormat(){return this.get(g.FORMAT)}setFormat(e){if(e.toUpperCase()in E)this.set(g.FORMAT,e.toUpperCase()),this.setElementSize(),this.getMap()&&(this.getMap().renderSync(),this.handleBboxChange()),this.changed();else throw new Error(`format must be on of: ${Object.values(E)}`)}getMargin(){return this.get(g.MARGIN)}setMargin(e){this.evtKeyMarginChange&&T(this.evtKeyMarginChange),this.evtKeyMarginChange=e.on("propertychange",()=>{this.setElementSize(),this.getMap()&&(this.getMap().renderSync(),this.handleBboxChange()),this.hasListener("change:margin")&&this.dispatchEvent(new w("change:margin",g.MARGIN,null)),this.hasListener("propertychange")&&this.dispatchEvent(new w("propertychange",g.MARGIN,null)),this.changed()}),this.set(g.MARGIN,e),this.setElementSize(),this.getMap()&&(this.getMap().renderSync(),this.handleBboxChange()),this.changed()}getBbox(){return this.getMap()?(this.getMap().renderSync(),this.get("bbox")):null}getBboxAsLonLat(){return this.getBbox()?f.transformExtent(this.getBbox(),"EPSG:3857","EPSG:4326"):null}computeBbox(){if(!this.getMap())return null;const{left:e,top:n,right:i,bottom:r}=this.printArea.getBoundingClientRect(),{x:h,y:c}=this.getMap().getViewport().getBoundingClientRect(),p=e-h,a=n-c,d=i-h,G=r-c,j=this.getMap().getCoordinateFromPixel([p,G]),H=this.getMap().getCoordinateFromPixel([d,a]);return[...j,...H]}getScaleDenominator(){if(this.getBboxAsLonLat()==null)return null;const e=this.getBboxAsLonLat(),n=e.slice(0,2),i=e.slice(2,4),r=B.getDistance(n,i),{width:h}=this.getPrintBoxSizeInMM(),c=h/1e3;return r/c}getPrintBoxSizeInDots(e=192){const{width:n,height:i}=this.getPrintBoxSizeInMM(),r=n/u,h=i/u;return{width:Math.round(r*e),height:Math.round(h*e)}}getPrintBoxSizeInMM(){const{short:e,long:n}=A[this.getFormat()],i=(this.getMargin().getLeft()+this.getMargin().getRight())*10,r=(this.getMargin().getTop()+this.getMargin().getBottom())*10;return this.getOrientation()==="portrait"?{width:e-i,height:n-r}:{width:n-i,height:e-r}}getPrintMarginsInPx(){const{width:e,height:n}=this.element.getBoundingClientRect(),{long:i}=A[this.getFormat()],r=this.getOrientation()==="portrait"?n/(i/10):e/(i/10);let h={top:0,bottom:0,left:0,right:0},c=this.getMargin().getProperties(),p;for(p in c)h[p]=c[p]*r;return h}getScreenMapAspectRatio(){var i;if(!((i=this.getMap())!=null&&i.getSize()))return 1;const[e,n]=this.getMap().getSize();return n===0?Number.MAX_SAFE_INTEGER:e/n}getPaperMapAspectRatio(){const{long:e,short:n}=A[this.getFormat()];return this.getOrientation()==="portrait"?n/e:e/n}getRestrictingDimension(){return this.getScreenMapAspectRatio()<this.getPaperMapAspectRatio()?"width":"height"}setElementSize(){this.getRestrictingDimension()==="width"?(this.element.style.height="",this.element.style.width="80%"):(this.element.style.height="80%",this.element.style.width="");const{long:e,short:n}=A[this.getFormat()],i=n/e;this.element.style.aspectRatio=String(this.getOrientation()==="portrait"?i:1/i),this.printArea.style.top=`${this.getPrintMarginsInPx().top}px`,this.printArea.style.bottom=`${this.getPrintMarginsInPx().bottom}px`,this.printArea.style.left=`${this.getPrintMarginsInPx().left}px`,this.printArea.style.right=`${this.getPrintMarginsInPx().right}px`}handleBboxChange(){this.set(g.BBOX,this.computeBbox()),this.changed()}onRender(e){if(!this._map||this._map!==this.getMap()){this._map=this.getMap();const n=this.getMap().getView().on("change",this.handleBboxChange.bind(this)),i=this.getMap().on("change:size",()=>{this.setElementSize(),this.handleBboxChange()});this.getMap().getControls().once("remove",r=>{r.element===this&&(this._map.getView().un("change",n.listener),this._map.un("change:size",i.listener),this._map=null)}),this.setElementSize(),this.set(g.BBOX,this.computeBbox(),!0),this.dispatchEvent("change")}}}class v extends I.Object{constructor(t={}){super();const{top:e=0,bottom:n=0,left:i=0,right:r=0}=t;this.set("top",e),this.set("bottom",n),this.set("left",i),this.set("right",r)}getProperties(){return super.getProperties()}getTop(){return this.get("top")}setTop(t){t=Math.max(0,Number(t)),this.set("top",t),this.changed()}getBottom(){return this.get("bottom")}setBottom(t){t=Math.max(0,Number(t)),this.set("bottom",t),this.changed()}getLeft(){return this.get("left")}setLeft(t){t=Math.max(0,Number(t)),this.set("left",t),this.changed()}getRight(){return this.get("right")}setRight(t){t=Math.max(0,Number(t)),this.set("right",t),this.changed()}}window.ol&&window.ol.control&&(window.ol.control.PrintLayout=L,window.ol.control.PrintLayout.Margin=v,window.PAPER_FORMAT=E,window.ORIENTATION=m),o.Margin=v,o.ORIENTATION=m,o.PAPER_FORMAT=E,o.PrintLayout=L,Object.defineProperties(o,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})});
//# sourceMappingURL=ol-print-layout-control.js.map
